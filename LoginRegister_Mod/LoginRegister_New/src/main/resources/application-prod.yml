# 生产环境配置 - 敏感信息请使用环境变量
# 通用配置请查看 application.yml

server:
  port: ${SERVER_PORT:8080}
  tomcat:
    max-connections: 500
    threads:
      max: 300
      min-spare: 50
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/xml,text/plain

spring:
  # 开发工具配置（生产环境禁用）
  devtools:
    restart:
      enabled: false
    livereload:
      enabled: false
  
  # 控制台输出颜色（生产环境禁用）
  output:
    ansi:
      enabled: never
  
  # 数据源配置（生产环境）
  datasource:
    url: ${DB_URL:jdbc:mysql://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:login_register_new}?useUnicode=true&characterEncoding=utf8&useSSL=true&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=false}
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:}
    hikari:
      pool-name: LoginRegisterHikariCP-Prod
      minimum-idle: 10
      maximum-pool-size: ${DB_MAX_POOL_SIZE:50}
      auto-commit: false
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      leak-detection-threshold: 60000
      register-mbeans: true
  
  # Redis配置（生产环境）
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      database: ${REDIS_DATABASE:0}
      timeout: 5000ms
      lettuce:
        pool:
          max-active: 20
          max-wait: 5000ms
          max-idle: 10
          min-idle: 5
  
  # 邮件配置（生产环境）
  mail:
    host: ${MAIL_HOST:smtp.qq.com}
    port: ${MAIL_PORT:465}
    username: ${MAIL_USERNAME:}
    password: ${MAIL_PASSWORD:}
    properties:
      mail:
        smtp:
          starttls:
            enable: true

# MyBatis日志配置（生产环境：使用Slf4j）
mybatis:
  configuration:
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl

mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl

# JWT配置（生产环境：使用环境变量）
jwt:
  secret: ${JWT_SECRET:}
  expiration: ${JWT_EXPIRATION:86400000}
  refresh-expiration: ${JWT_REFRESH_EXPIRATION:604800000}

# OAuth配置（生产环境：使用环境变量）
qq:
  oauth:
    app-id: ${QQ_APP_ID:}
    app-key: ${QQ_APP_KEY:}
    redirect-uri: ${QQ_REDIRECT_URI:}

google:
  oauth:
    client-id: ${GOOGLE_CLIENT_ID:}
    client-secret: ${GOOGLE_CLIENT_SECRET:}
    redirect-uri: ${GOOGLE_REDIRECT_URI:}

wechat:
  oauth:
    app-id: ${WECHAT_APP_ID:}
    app-secret: ${WECHAT_APP_SECRET:}
    redirect-uri: ${WECHAT_REDIRECT_URI:}

# MinIO配置（生产环境：使用环境变量）
minio:
  endpoint: ${MINIO_ENDPOINT:http://localhost:9000}
  access-key: ${MINIO_ACCESS_KEY:}
  secret-key: ${MINIO_SECRET_KEY:}
  bucket-name: ${MINIO_BUCKET_NAME:avatar}
  secure: ${MINIO_SECURE:false}

logging:
  level:
    root: WARN
    com.vortex.loginregister_new: INFO
    com.vortex.loginregister_new.util.SecurityAuditLogger: INFO
    org.springframework: WARN
    org.apache.ibatis: WARN
    com.zaxxer.hikari: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n"
  file:
    name: ${LOG_FILE_PATH:logs/login-register.log}
  logback:
    rollingpolicy:
      max-file-size: ${LOG_MAX_SIZE:50MB}
      total-size-cap: ${LOG_TOTAL_SIZE:1GB}
      max-history: ${LOG_MAX_HISTORY:30}

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    tags:
      environment: production

# SpringDoc配置（生产环境禁用）
springdoc:
  api-docs:
    enabled: false
  swagger-ui:
    enabled: false
